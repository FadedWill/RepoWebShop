<link href="~/Content/Admin/AllProducts.css" rel="stylesheet" />

<div class="container">
    <h2>Todos los productos</h2>
    <div id="allProducts-div">
        <table id="allProducts" class="display nowrap dataTable dtr-inline collapsed" cellspacing="0" role="grid">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Destacado</th>
                    <th>Descripcion</th>
                    <th>Categoria</th>
                </tr>
            </thead>
            <tbody id='allProducts-tbody'></tbody>
        </table>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        getProducts();
    });

    function getProducts() {
        var url = "/api/AdminData/GetProducts";
        $.ajax({
            url: url,
            method: "GET",
            success: onSuccess,
            error: function (error) {
                console.log(error);
            }
        });
    }

    function onSuccess(data) {
        $.each(data, function (index, item) {
            $('#allProducts-tbody').append(getRow(item));
        });
        $('#allProducts').DataTable({
            "order": [[0, "asc"]]
        });
        $('#allProducts-div').parent().css('overflow', 'auto');
        $('#allProducts-div').css('width', '100%');
        $('#allProducts-div').show();
    }

    function getRow(item) {
        var row = $('<tr>');
        var state = '';
        if (!item.isActive)
            state = '<div class="text-muted"> Inactivo</div>';
        row.append('<td><a href="/Admin/EditPieDetail/' + item.pieDetailId + '">' + item.name + '</a>' + state + '</td>');

        if (item.isPieOfTheWeek)
            row.append('<td><input type="button" value="Quitar" onclick="removeHighlight(' + item.pieDetailId + ');" /></td>');
        else
            row.append('<td><input type="button" value="Agregar" onclick="addHighlight(' + item.pieDetailId + ');" /></td>');
        row.append('<td>' + item.shortDescription + '</td>');
        row.append('<td>' + item.category.categoryName + '</td>');
        console.log(item);
        return row;
    }

    function removeHighlight(pieDetailId) {
        $.post("/api/PieDetailData/RemovePieOfTheWeek/" + pieDetailId, function (data) {
            window.location.reload();
        }).fail(function () {
            alert('No se pudo hacer el cambio.');
        });
    }

    function addHighlight(pieDetailId) {
        $.post("/api/PieDetailData/AddPieOfTheWeek/" + pieDetailId, function (data) {
            window.location.reload();
        }).fail(function () {
            alert('No se pudo hacer el cambio.');
        });
    };
</script>